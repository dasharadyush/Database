USE Продажи
GO

/*2)По одному разу все даты, когда купили какой-нибудь товар*/
SELECT DISTINCT CAST(Дата AS date) as 'Дата'
FROM Продажи

/*3)Уникальных покупателей, упорядоченных по алфавиту*/
SELECT DISTINCT Покупатель
FROM Продажи
ORDER BY Покупатель

/*4)Уникальные товары, которые хотя бы раз были проданы по цене больше 100*/
SELECT DISTINCT Товар
FROM Продажи
WHERE Цена > 100

/*5)Уникальных покупателей, которые закупались на прошлой неделе (считаю как 7 дней назад включая вчерашний)*/
SELECT DISTINCT Покупатель
FROM Продажи
WHERE Дата <= DATEADD(week,0, getdate()) AND Дата > DATEADD(week,-1, getdate())

/*6)Для каждой строки документов стоимость товара, купленного покупателем*/
SELECT нДок, CAST(Дата AS date) as 'Дата', Покупатель, Товар, Колво, Цена, Цена*Колво AS 'Стоимость'
FROM Продажи

/*7)Все записи о покупках, для которых документ был введен в январе текущего года и покупатель начинается с буквы «А» или колво товара больше 5-ти, а цена меньше 10*/
SELECT нДок, CAST(Дата AS date) as 'Дата', Покупатель, Товар, Колво, Цена
FROM Продажи
WHERE (MONTH(Дата) = 01 AND YEAR(Дата)= YEAR(getdate()) and Покупатель like 'А%') or (Колво > 5 and Цена < 10)
ORDER BY Дата asc, Цена desc

/*8)5 первых покупателей, закупавшихся в сентябре прошлого года, из списка покупателей, упорядоченных по алфавиту.*/
SELECT DISTINCT top 5 with ties Покупатель
FROM Продажи
WHERE MONTH(Дата) = 09 AND YEAR(Дата)=YEAR(getdate())-1
ORDER BY Покупатель

/*9)Уникальных покупателей, которые покупали товар, название которого задано параметром.*/
DECLARE @param as nvarchar(50)
SET @param = 'Мороженое'
SELECT DISTINCT Покупатель
FROM Продажи
WHERE Товар = @param

/*10)Номер документа, по которому продали товар с максимальной стоимостью*/
/*Если есть несколько с максимальной стоимостью, выведет все*/
SELECT top 1 with ties нДок
FROM Продажи
ORDER BY Цена*Колво desc

/*11)По каждому документу посчитать суммарную стоимость всех товаров в документе, когда в документе несколько товаров*/
SELECT нДок, SUM(Цена*Колво) AS 'Сумма'
FROM Продажи
GROUP BY нДок
